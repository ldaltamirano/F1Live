---
import Layout from "../layouts/Layout.astro";
import fs from 'node:fs/promises';
import path from 'node:path';
import DriverCard from "@components/pilotos/DriverCard.astro";

// Carga de datos de pilotos
const driversPath = path.join(process.cwd(), 'public', 'drivers_2026.json');
const teamsPath = path.join(process.cwd(), 'public', 'teams_2026.json'); 

let drivers: any[] = [];

try {
  const [driversContent, teamsContent] = await Promise.all([
    fs.readFile(driversPath, 'utf-8'),
    fs.readFile(teamsPath, 'utf-8')
  ]);

  const driversData = JSON.parse(driversContent);
  const teamsData = JSON.parse(teamsContent);

  // Fusionamos la info del piloto con la de su equipo para tener colores y logos
  drivers = driversData.map((driver: any) => {
    // Buscamos el equipo que tenga al piloto en su lista de driver_ids
    const team = teamsData.find((t: any) => t.driver_ids?.includes(driver.id)) || teamsData.find((t: any) => t.id === driver.team_id);
    return { ...driver, team };
  });

} catch (error) {
  console.error("Error al cargar los pilotos:", error);
}
---

<Layout title="F1 Live - Pilotos">
  <div class="bg-[#15151e] min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-4xl md:text-6xl font-black text-center text-white mb-16 uppercase italic tracking-tighter">
        F1 Drivers <span class="text-[#e10600]">2026</span>
      </h1>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {drivers.map((driver) => (
          <DriverCard driver={driver} />
        ))}
      </div>
    </div>
  </div>
</Layout>