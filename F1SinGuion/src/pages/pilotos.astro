---
import Layout from "../layouts/Layout.astro";
import fs from 'node:fs/promises';
import path from 'node:path';
import DriverCard from "@components/pilotos/DriverCard.astro";

// Carga de datos de pilotos
const driversPath = path.join(process.cwd(), 'public', 'drivers_2026.json');
const teamsPath = path.join(process.cwd(), 'public', 'teams_2026.json'); 

let driversByTeam: { team: any, drivers: any[] }[] = [];

try {
  const [driversContent, teamsContent] = await Promise.all([
    fs.readFile(driversPath, 'utf-8'),
    fs.readFile(teamsPath, 'utf-8')
  ]);

  const driversData = JSON.parse(driversContent);
  const teamsData = JSON.parse(teamsContent);

  // Agrupar pilotos por equipo
  driversByTeam = teamsData.map((team: any) => {
    const teamDrivers = driversData
      .filter((d: any) => team.driver_ids?.includes(d.id) || d.team_id === team.id)
      .map((d: any) => ({ ...d, team })); // Inyectar info del equipo
    
    return { team, drivers: teamDrivers };
  }).filter((group: any) => group.drivers.length > 0);

} catch (error) {
  console.error("Error al cargar los pilotos:", error);
}
---

<Layout title="F1 Live - Pilotos">
  <div class="bg-bg min-h-screen py-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden">
    
    {/* Texture Overlay (Carbon Fiber feel) */}
    <div class="absolute inset-0 opacity-[0.03] pointer-events-none" style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 4px 4px;"></div>
    
    {/* Ambient Background */}
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[600px] blur-[150px] rounded-full pointer-events-none"></div>
    <div class="absolute bottom-0 right-0 w-[600px] h-[600px] bg-cyan-900/10 blur-[150px] rounded-full pointer-events-none"></div>

    <div class="max-w-7xl mx-auto relative z-10">
      <h1 class="text-4xl md:text-6xl font-black text-center text-white mb-16 uppercase italic tracking-tighter">
        F1 Drivers <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-600">2026</span>
      </h1>

      <div class="space-y-20">
        {driversByTeam.map(({ team, drivers }) => (
          <section class="relative">
             {/* Team Header */}
             <div class="flex items-end gap-6 mb-8 border-b border-white/5 pb-4">
                <div class="w-32 h- bg-white/90 rounded-xl p-3 backdrop-blur-sm border border-white/10 flex items-center justify-center">
                    <img src={team.logo} alt={team.nombre} class="max-w-full max-h-full object-contain" />
                </div>
                <div>
                    <h2 class="text-3xl md:text-4xl font-black text-white italic uppercase tracking-tighter leading-none mb-1">
                        {team.nombre}
                    </h2>
                    <div class="h-1 w-full max-w-[200px] rounded-full" style={`background-color: ${team.color_var}`}></div>
                </div>
             </div>

             {/* Drivers Grid */}
             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {drivers.map((driver) => (
                  <DriverCard driver={driver} />
                ))}
             </div>
          </section>
        ))}
      </div>
    </div>
  </div>
</Layout>