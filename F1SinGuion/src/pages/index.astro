---
import Layout from '../layouts/Layout.astro';
import HeroBackground from '@components/ui/HeroBackground.astro';
import NewsCard from '@components/noticias/NewsCard.astro';
import { getAllNews } from '@lib/services/newssService';

// Cargar noticias
let news = [];

try {
  const rawNews = await getAllNews();
  // Mapeamos el campo 'index' (slug) a 'id' para que el componente NewsCard genere los enlaces correctamente
  news = rawNews.map(n => ({
    ...n,
    id: n.index
  }));
} catch (error) {
  console.error("Error al cargar noticias:", error);
}

// La consulta a la BD ya ordena por fecha descendente

const principalNews = news.find((n: any) => n.tipo === 'principal');
const otherNews = news.filter((n: any) => n.tipo !== 'principal');

---

<Layout 
  title="F1 Live 2026 - Inicio"
  description="Sigue toda la acción de la Fórmula 1 2026. Noticias, resultados, clasificaciones y estadísticas en tiempo real."
>
  <main class="bg-bg min-h-screen">
    
    {/* Hero Section */}
    <section class="relative h-[60vh] min-h-[500px] flex items-center justify-center overflow-hidden">
      <div class="absolute inset-0 z-0">
        <HeroBackground class="text-text opacity-20" />
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-bg/60 to-bg"></div>
      </div>
      
      <div class="relative z-10 text-center px-4">
        <h1 class="text-6xl md:text-8xl font-black text-text italic uppercase tracking-tighter mb-4 drop-shadow-2xl">
          F1 Live <span class="text-transparent bg-clip-text bg-gradient-to-r from-secondary to-primary drop-shadow-[-5px_0_15px_rgba(217,70,239,0.5)] drop-shadow-[5px_0_15px_rgba(59,130,246,0.5)]">2026</span>
        </h1>
        <p class="text-xl md:text-2xl text-text-muted font-light tracking-wide max-w-2xl mx-auto">
          Experience the new era of Formula 1.
        </p>
      </div>
    </section>

    {/* Sección de Noticias */}
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 -mt-32 relative z-20">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-black text-transparent bg-clip-text text-white uppercase italic tracking-tighter border-l-4 border-secondary pl-4">
          Latest News
        </h2>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {/* Noticia Principal (ocupa 2 columnas en desktop) */}
        {principalNews && (
          <div class="md:col-span-2 lg:col-span-2">
            <NewsCard news={principalNews} featured={true} />
          </div>
        )}

        {/* Resto de noticias */}
        {otherNews.map((item: any) => (
          <NewsCard news={item} />
        ))}
      </div>
    </section>

  </main>
</Layout>